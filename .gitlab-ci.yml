# https://docs.gitlab.com/ce/ci/yaml/README.html
# https://docs.gitlab.com/ce/ci/variables/README.html

cache:
  paths:
  - binaries/*

stages:
  - build
  - test
  - deploy

before_script:
  - echo "Before running build steps"
  - hostname

build-osx-1:
  stage: build
  tags:
    - osx
  script:
    - echo "Building OSX"
    - pwd
    - ls -la
    - export GOPATH=~/go
    - export GOBIN=~/go/bin
    - export | grep GO
    - go env
    - go get ./
    - "go build -o binaries/osx-narcotk-hosts-${CI_COMMIT_SHA} main.go"
    - ls -la binaries/*
  artifacts:
    name: "${CI_JOB_NAME}_${CI_COMMIT_SHA}"
    untracked: true
    paths:
      - binaries/*

test-osx-1:
  stage: test
  tags:
    - osx
  script:
    - echo "Testing OSX --help"
    - pwd
    - ls -la
    - echo "Testing Display of help"
    - binaries/osx-narcotk-hosts-${CI_COMMIT_SHA} --help

test-osx-2:
  stage: test
  tags:
    - osx
  script:
    - echo "Testing OSX listing hosts"
    - pwd
    - ls -la
    - echo "Testing Display of help"
    - binaries/osx-narcotk-hosts-${CI_COMMIT_SHA} --configfile=narco-hosts-config.json --database=narcotk_hosts_all.db


deploy-osx-1:
  stage: deploy
  tags:
    - osx
  script:
    - echo "deploy stage"
